# MLBB-API Project Context

## Project Overview

This repository contains the Mobile Legends: Bang Bang hero, item, and emblem metadata database. It serves as the central data source for multiple MLBB projects including TeddyBotv3 Discord bot, MLBB-DraftPickSimulator, and MLBB-BuildShare.

## Integration Points

### TeddyBotv3 Discord Bot
- **Location:** `/root/MLBB-TeddyBot-v3`
- **Data Source:** Fetches hero metadata from `https://raw.githubusercontent.com/p3hndrx/MLBB-API/main/v1/hero-meta-final.json`
- **Cache:** 24-hour TTL on hero metadata
- **Usage:** Discord emoji display in `/td` and `/tdhero` commands
- **Critical Fields:** `hero_name`, `mlid`, `discordmoji`

### MLBB-DraftPickSimulator
- **Hero Icons:** `/var/www/sites/mlbb.site/MLBB-DraftPickSimulator/img/heroes/*.png`
- **Format:** PNG/WebP images
- **Naming:** Lowercase hero name (e.g., `sora.png`)

### MLBB-BuildShare
- **Hero Icons:** `/var/www/sites/mlbb.site/MLBB-BuildShare/http/img/heroes/*.png`
- **Format:** PNG/WebP images
- **Naming:** Lowercase hero name (e.g., `sora.png`)

## Operational Workflow: New Hero Release

New heroes are released approximately every 3-4 months. Follow this workflow to update the database.

### Step 1: Status Check

Check the current database status and identify missing heroes:

```bash
cd /var/www/sites/mlbb.site/MLBB-API

# Check current revision date
jq -r '.revdate' v1/hero-meta-final.json

# Count total heroes
jq '.data | length' v1/hero-meta-final.json

# Check last 5 heroes
jq -r '.data[-5:] | .[] | "\(.hero_name) - mlid: \(.mlid) - year: \(.release_year)"' v1/hero-meta-final.json
```

### Step 2: Research New Hero Data

Gather comprehensive hero information from official sources:

**Primary Data Sources:**

1. **GMS API (Recommended for Real-Time Data)**
   - Endpoint: `https://api.gms.moontontech.com/api/gms/source/2669606/2756567`
   - Provides: Hero IDs, names, portraits, real-time statistics
   - Used by: TeddyBotv3, official mobilelegends.com
   - See "Using GMS API for Hero Data" section below for details

2. **Mobile Legends Fandom Wiki**
   - URL: `https://mobile-legends.fandom.com/wiki/{HeroName}`
   - Provides: Skills, lore, release dates, detailed stats
   - Best for: Skill descriptions, specialties, background info

3. **Official MLBB News/Patch Notes**
   - Provides: Release announcements, hero overviews
   - Best for: Release dates, official hero descriptions

4. **Gaming News Sites**
   - gamingonphone.com, oneesports.gg, esports.gg
   - Provides: Release dates, hero guides, meta analysis
   - Best for: Confirming release dates and initial hero info

**Required Data:**
1. Hero Name
2. MLID (hero ID number, sequential)
3. UID (internal name/code name)
4. Release Date (month/year)
5. Class (Fighter, Mage, etc.)
6. Laning position (exp lane, mid lane, etc.)
7. Specialty (Charge, Burst, Damage, etc.)
8. Skills (passive + 3 active skills with descriptions)
9. Counters & Synergies (if available)
10. Portrait URL (from youngjoygame.com)
11. Hero Icon URL (from wikia)

**Search Queries:**
- "Mobile Legends {HeroName} release date"
- "MLBB {HeroName} skills overview"
- "Mobile Legends {HeroName} hero id"

#### Using GMS API for Hero Data

The GMS API can be used to pull real-time hero data including IDs, names, and portraits.

**1. Test API Connection:**

```bash
curl -X POST 'https://api.gms.moontontech.com/api/gms/source/2669606/2756567' \
  -H 'Content-Type: application/json;charset=UTF-8' \
  -H 'x-lang: en' \
  -d '{
    "pageSize": 150,
    "pageIndex": 1,
    "filters": [{"field": "match_type", "operator": "eq", "value": 0}],
    "sorts": [{"data": {"field": "main_heroid", "order": "desc"}, "type": "sequence"}],
    "fields": ["main_hero", "main_heroid"]
  }'
```

**2. Extract Hero Information:**

```bash
# Get all heroes sorted by ID (newest first)
curl -X POST 'https://api.gms.moontontech.com/api/gms/source/2669606/2756567' \
  -H 'Content-Type: application/json;charset=UTF-8' \
  -H 'x-lang: en' \
  -d '{
    "pageSize": 150,
    "pageIndex": 1,
    "filters": [{"field": "match_type", "operator": "eq", "value": 0}],
    "sorts": [{"data": {"field": "main_heroid", "order": "desc"}, "type": "sequence"}],
    "fields": ["main_hero", "main_hero_appearance_rate", "main_hero_ban_rate",
               "main_hero_channel", "main_hero_win_rate", "main_heroid"]
  }' | jq '.data.records[0:5] | .[] | {
    id: .data.main_heroid,
    name: .data.main_hero.data.name,
    portrait: .data.main_hero.data.head
  }'
```

**3. Find Newest Hero:**

```bash
# Get hero with highest ID (likely the newest)
curl -X POST 'https://api.gms.moontontech.com/api/gms/source/2669606/2756567' \
  -H 'Content-Type: application/json;charset=UTF-8' \
  -H 'x-lang: en' \
  -d '{
    "pageSize": 1,
    "pageIndex": 1,
    "filters": [{"field": "match_type", "operator": "eq", "value": 0}],
    "sorts": [{"data": {"field": "main_heroid", "order": "desc"}, "type": "sequence"}],
    "fields": ["main_hero", "main_heroid"]
  }' | jq '.data.records[0] | {
    heroid: .data.main_heroid,
    name: .data.main_hero.data.name,
    portrait: .data.main_hero.data.head
  }'
```

**GMS API Response Format:**

```json
{
  "code": 0,
  "message": "OK",
  "data": {
    "records": [{
      "data": {
        "main_hero": {
          "data": {
            "name": "Sora",
            "head": "https://akmweb.youngjoygame.com/web/svnres/img/mlbb/..."
          }
        },
        "main_heroid": 131,
        "main_hero_win_rate": 0.5245,
        "main_hero_appearance_rate": 0.0823,
        "main_hero_ban_rate": 0.3156
      }
    }],
    "total": 131
  }
}
```

**Advantages of GMS API:**
- âœ… Real-time data directly from official servers
- âœ… Accurate hero IDs (mlid values)
- âœ… Portrait URLs already in correct format
- âœ… Can discover new heroes immediately after release
- âœ… No manual searching required

**When to Use GMS API:**
- Finding the newest hero's ID and name
- Getting accurate portrait URLs
- Verifying hero count and IDs
- Quick hero name lookups

**When to Use Manual Research:**
- Skill descriptions and details
- Release dates and years
- Hero lore and background
- Specialty classifications
- Counters and synergies data

### Step 3: Update hero-meta-final.json

#### 3.1 Update Revision Date

```bash
# Update revdate to current date (format: YYYYMMDD)
# Example: 20251226 for December 26, 2025
```

Edit the file and change:
```json
"revdate": "20251130"  â†’  "revdate": "20251226"
```

#### 3.2 Add Release Years for Recent Heroes

Update any heroes with empty `release_year` fields based on research.

Example release dates to reference:
- Suyou (126): September 21, 2024 â†’ "2024"
- Lukas (127): December 21, 2024 â†’ "2024"
- Kalea (128): March 19, 2025 â†’ "2025"
- Zetian (129): June 18, 2025 â†’ "2025"
- Obsidia (130): September 17, 2025 â†’ "2025"
- Sora (131): December 18, 2025 â†’ "2025"

#### 3.3 Add New Hero Entry

Add new hero at the end of the `data` array, before the closing brackets.

**Template:**
```json
{
    "hero_name": "HeroName",
    "mlid": "###",
    "uid": "internal_name",
    "id": "h###",
    "hero_icon": "heroname.png",
    "discordmoji": "<:heroname:DISCORD_EMOJI_ID>",
    "portrait": "https://akmweb.youngjoygame.com/...",
    "release_year": "YYYY",
    "laning": [
        "exp lane"
    ],
    "class": "Fighter, Assassin",
    "skills": [
        {
            "skill_name": "Passive Name",
            "skill_icon": "hero-skills-images/heroname/passive.png",
            "type": "passive",
            "cooldown": "null",
            "manacost": "null",
            "description": "Passive description..."
        },
        {
            "skill_name": "Skill 1 Name",
            "skill_icon": "hero-skills-images/heroname/skill_1.png",
            "type": "active",
            "cooldown": "5.0",
            "manacost": "null",
            "description": "Skill 1 description..."
        },
        {
            "skill_name": "Skill 2 Name",
            "skill_icon": "hero-skills-images/heroname/skill_2.png",
            "type": "active",
            "cooldown": "8.0",
            "manacost": "null",
            "description": "Skill 2 description..."
        },
        {
            "skill_name": "Ultimate Name",
            "skill_icon": "hero-skills-images/heroname/ultimate.png",
            "type": "active",
            "cooldown": "24.0",
            "manacost": "null",
            "description": "Ultimate description..."
        }
    ],
    "speciality": [
        "Charge",
        "Burst"
    ],
    "counters": [],
    "synergies": []
}
```

**Important Notes:**
- MLID should be sequential (last hero + 1)
- UID is typically the hero's internal code name
- ID follows format `h###` where ### matches mlid
- hero_icon follows format `heroname.png` (lowercase)
- Leave `discordmoji` empty initially if emoji not available
- Leave `counters` and `synergies` empty initially (can be populated later)

#### 3.4 Validate JSON

```bash
# Validate JSON syntax
jq . v1/hero-meta-final.json > /dev/null && echo "Valid JSON" || echo "Invalid JSON"

# Verify new hero was added
jq -r '.data[-1] | "\(.hero_name) - mlid: \(.mlid) - year: \(.release_year)"' v1/hero-meta-final.json

# Count total heroes
jq '.data | length' v1/hero-meta-final.json
```

### Step 4: Download and Deploy Hero Icon

#### 4.1 Download Hero Icon

Find hero icon URL from Mobile Legends Fandom Wiki:
- Pattern: `https://static.wikia.nocookie.net/mobile-legends/images/.../Hero####-icon.png`
- Example: `https://static.wikia.nocookie.net/mobile-legends/images/c/cc/Hero1311-icon.png`

```bash
# Download hero icon
wget -O /tmp/heroname.png "HERO_ICON_URL"

# Verify file type
file /tmp/heroname.png
```

#### 4.2 Deploy to Project Directories

```bash
# Copy to MLBB-DraftPickSimulator
cp /tmp/heroname.png /var/www/sites/mlbb.site/MLBB-DraftPickSimulator/img/heroes/heroname.png

# Copy to MLBB-BuildShare
cp /tmp/heroname.png /var/www/sites/mlbb.site/MLBB-BuildShare/http/img/heroes/heroname.png

# Verify files created
ls -lh /var/www/sites/mlbb.site/MLBB-DraftPickSimulator/img/heroes/heroname.png
ls -lh /var/www/sites/mlbb.site/MLBB-BuildShare/http/img/heroes/heroname.png

# Clean up temp file
rm /tmp/heroname.png
```

#### 4.3 Verify Hero Icon Counts

```bash
# Count heroes in each directory (should match total heroes in JSON)
ls -1 /var/www/sites/mlbb.site/MLBB-DraftPickSimulator/img/heroes/*.png | wc -l
ls -1 /var/www/sites/mlbb.site/MLBB-BuildShare/http/img/heroes/*.png | wc -l
```

### Step 5: Add Discord Emoji (Optional)

If Discord emoji is available, update the hero's `discordmoji` field:

```json
"discordmoji": "<:sora:1454317866026270974>"
```

Format: `<:emoji_name:emoji_id>`

### Step 6: Commit and Push to GitHub

#### 6.1 Review Changes

```bash
cd /var/www/sites/mlbb.site/MLBB-API

# Check git status
git status

# Review changes
git diff v1/hero-meta-final.json
```

#### 6.2 Commit Changes

```bash
# Add file to staging
git add v1/hero-meta-final.json

# Commit with descriptive message
git commit -m "$(cat <<'EOF'
[Month] [Year] hero meta update: Add [HeroName] and update release years

- Added [HeroName] (hero #[mlid], mlid: [mlid]) - Released [Date]
  - [Class] with [unique mechanic description]
  - Complete skill data including [skill names]

- Updated release_year for recent heroes:
  - [HeroName] (mlid: ###): [YYYY]

- Updated revdate to [YYYYMMDD]

Total heroes: [count] ([count-1] playable + 1 None placeholder)

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"
```

#### 6.3 Push to GitHub

**Method 1: Using Personal Access Token (PAT)**

```bash
# Set remote URL with token (temporary)
git remote set-url origin https://TOKEN@github.com/p3hndrx/MLBB-API.git

# Push changes
git push origin main

# Remove token from remote URL (security)
git remote set-url origin https://github.com/p3hndrx/MLBB-API.git
```

**Method 2: Using SSH (if configured)**

```bash
# Ensure SSH remote is configured
git remote set-url origin git@github.com:p3hndrx/MLBB-API.git

# Push changes
git push origin main
```

#### 6.4 Verify Push

```bash
# Check git status
git status

# View recent commits
git log --oneline -3
```

### Step 7: Verify Integration

#### 7.1 GitHub Repository

- Visit: `https://github.com/p3hndrx/MLBB-API`
- Verify latest commit appears
- Check `v1/hero-meta-final.json` in GitHub

#### 7.2 TeddyBotv3 Integration

**Automatic Update:**
- TeddyBotv3 will fetch updated metadata within 24 hours (cache TTL)
- No manual intervention required

**Manual Cache Clear (if needed):**
```bash
cd /root/MLBB-TeddyBot-v3
# Restart bot to clear cache immediately
# (Specific restart command depends on deployment method)
```

**Test in Discord:**
```
/td tier:All sort:Win Rate
/tdhero hero:HeroName
```

Verify:
- New hero appears in tier lists
- Discord emoji displays correctly (if added)
- Hero stats load properly

## Common Issues and Troubleshooting

### JSON Validation Errors

**Issue:** Invalid JSON syntax after editing

**Solution:**
```bash
# Use jq to identify syntax errors
jq . v1/hero-meta-final.json

# Common issues:
# - Missing comma between objects
# - Extra comma before closing bracket
# - Unescaped quotes in descriptions
# - Mismatched brackets
```

### Git Push Authentication Failures

**Issue:** `Permission denied` or `could not read Username`

**Solutions:**
1. Verify GitHub PAT has `repo` scope
2. Check SSH key is added to GitHub account
3. Ensure remote URL is correct format
4. Use credential helper for HTTPS

### Hero Icon Not Found

**Issue:** 404 error when downloading hero icon

**Solutions:**
1. Check Mobile Legends Fandom Wiki for correct URL
2. Try alternative image sources (official MLBB site)
3. Verify hero ID number in URL matches mlid
4. Check if URL requires different image format (WebP vs PNG)

### TeddyBot Not Showing New Hero

**Issue:** New hero doesn't appear in Discord bot after 24 hours

**Checklist:**
1. Verify hero is in GitHub (check raw URL)
2. Check hero metadata cache TTL (24 hours)
3. Verify `discordmoji` field is populated (if using emojis)
4. Check bot logs for API fetch errors
5. Restart bot to force cache refresh

## File Structure

```
MLBB-API/
â”œâ”€â”€ v1/
â”‚   â”œâ”€â”€ hero-meta-final.json      # Main hero database (THIS IS THE PRIMARY FILE)
â”‚   â”œâ”€â”€ item-meta-final.json      # Item database
â”‚   â””â”€â”€ emblem-meta-final.json    # Emblem database
â”œâ”€â”€ specification/
â”‚   â”œâ”€â”€ hero-meta.json            # Hero schema definition
â”‚   â”œâ”€â”€ item-meta.json            # Item schema definition
â”‚   â”œâ”€â”€ emblem-meta.json          # Emblem schema definition
â”‚   â””â”€â”€ modifiers-schema.json     # Modifiers schema
â”œâ”€â”€ sample data/                   # Sample data for reference
â”œâ”€â”€ README.md                      # Project documentation
â””â”€â”€ .claude_project_context.md    # This file
```

## Hero Database Schema

### Required Fields

| Field | Type | Description | Example |
|-------|------|-------------|---------|
| `hero_name` | string | Hero display name | "Sora" |
| `mlid` | string | Mobile Legends ID (sequential) | "131" |
| `uid` | string | Internal/code name | "cirrus" |
| `id` | string | Hero identifier (h + mlid) | "h131" |
| `hero_icon` | string | Icon filename | "sora.png" |
| `discordmoji` | string | Discord emoji code | "<:sora:1454317866026270974>" |
| `portrait` | string | Full portrait URL | "https://akmweb.youngjoygame.com/..." |
| `release_year` | string | Year released | "2025" |
| `laning` | array | Lane positions | ["exp lane"] |
| `class` | string | Hero class(es) | "Fighter, Assassin" |
| `skills` | array | Skill objects (4 skills) | [...] |
| `speciality` | array | Hero specialties | ["Charge", "Burst"] |
| `counters` | array | Counter hero objects | [...] |
| `synergies` | array | Synergy hero objects | [...] |

### Skill Object Schema

```json
{
    "skill_name": "string",
    "skill_icon": "string (path)",
    "type": "passive|active",
    "cooldown": "string (number or 'null')",
    "manacost": "string (number range or 'null')",
    "description": "string"
}
```

### Counter/Synergy Object Schema

```json
{
    "heroid": 123,
    "heroname": "HeroName"
}
```

## Revision History

- **20251226** - Added Sora (hero #131), updated release years for heroes 126-130
- **20251130** - Enriched 129 heroes with complete data from MLBB-Exfil
- **20251130** - Added counters, synergies, speciality to hero schema
- **20251130** - Updated MLBB-API with 2025 data from mlbb.io

## Related Projects

- **MLBB-TeddyBot-v3:** `/root/MLBB-TeddyBot-v3`
  - Discord bot using GMS API for tier data
  - Fetches hero metadata from this repository
  - See: `/root/MLBB-TeddyBot-v3/.claude_project_context.md`

- **MLBB-DraftPickSimulator:** `/var/www/sites/mlbb.site/MLBB-DraftPickSimulator`
  - Hero draft pick simulator
  - Uses hero icons from `img/heroes/*.png`

- **MLBB-BuildShare:** `/var/www/sites/mlbb.site/MLBB-BuildShare`
  - Hero build sharing platform
  - Uses hero icons from `http/img/heroes/*.png`

- **MLBB-Exfil:** `/root/MLBB-Exfil`
  - Data extraction tool for enriching hero metadata
  - Used to populate counters, synergies, and detailed stats
  - Reference for bulk data updates

## Additional Data Sources

### GMS API Time Period Endpoints

The GMS API supports different time periods for historical data:

```javascript
TIME_PERIODS = {
    "1_day": {"endpoint": "2756567", "name": "1 Day", "days": 1},
    "3_days": {"endpoint": "2756568", "name": "3 Days", "days": 3},
    "7_days": {"endpoint": "2756569", "name": "7 Days", "days": 7},
    "15_days": {"endpoint": "2756565", "name": "15 Days", "days": 15},
    "30_days": {"endpoint": "2756570", "name": "30 Days", "days": 30}
}
```

**Base URL:** `https://api.gms.moontontech.com/api/gms/source/2669606/{endpoint}`

Example:
- 1 Day: `https://api.gms.moontontech.com/api/gms/source/2669606/2756567`
- 7 Days: `https://api.gms.moontontech.com/api/gms/source/2669606/2756569`

### Hero Detail Endpoint

For detailed hero information including counters and relations:

**Endpoint:** `https://api.gms.moontontech.com/api/gms/source/2669606/2756564`

**Request:**
```bash
curl -X POST 'https://api.gms.moontontech.com/api/gms/source/2669606/2756564' \
  -H 'Content-Type: application/json;charset=UTF-8' \
  -H 'x-lang: en' \
  -d '{
    "pageSize": 20,
    "pageIndex": 1,
    "filters": [{"field": "hero_id", "operator": "eq", "value": "131"}],
    "sorts": [],
    "object": []
  }'
```

Returns hero relations data including counters and synergies.

### MLBB-Exfil Tool

Location: `/root/MLBB-Exfil`

Use for:
- Bulk data extraction and enrichment
- Automated counter/synergy updates
- Portrait URL updates
- Mass data validation

## Maintenance Schedule

- **Hero Updates:** Every 3-4 months (when new heroes are released)
- **Item Updates:** As needed when items are added/changed
- **Emblem Updates:** As needed when emblem system changes
- **Data Enrichment:** Periodic updates to counters, synergies, portraits
- **GMS API Monitoring:** Check for API endpoint changes quarterly

## Contact & Support

- **Repository:** https://github.com/p3hndrx/MLBB-API
- **Author:** p3hndrx
- **Issues:** Report at GitHub Issues

---

**Last Updated:** December 26, 2025
**Hero Count:** 132 (131 playable + 1 None placeholder)
**Latest Hero:** Sora (mlid: 131)
